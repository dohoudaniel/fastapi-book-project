# FastAPI Book Management API

## Overview

This project is a RESTful API built with FastAPI for managing a book collection. It provides comprehensive CRUD (Create, Read, Update, Delete) operations for books with proper error handling, input validation, and documentation.

## Features

- ğŸ“š Book management (CRUD operations)
- âœ… Input validation using Pydantic models
- ğŸ” Enum-based genre classification
- ğŸ§ª Complete test coverage
- ğŸ“ API documentation (auto-generated by FastAPI)
- ğŸ”’ CORS middleware enabled

## Project Structure

```
fastapi-book-project/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ schemas.py      # Data models and in-memory database
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ books.py        # Book route handlers
â”‚   â””â”€â”€ router.py           # API router configuration
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ config.py           # Application settings
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_books.py       # API endpoint tests
â”œâ”€â”€ main.py                 # Application entry point
â”œâ”€â”€ requirements.txt        # Project dependencies
â””â”€â”€ README.md
```

## Technologies Used

- Python 3.12
- FastAPI
- Pydantic
- pytest
- uvicorn

## Installation

1. Clone the repository:

```bash
git clone https://github.com/hng12-devbotops/fastapi-book-project.git
cd fastapi-book-project
```

2. Create a virtual environment:

```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

3. Install dependencies:

```bash
pip install -r requirements.txt
```

## Running the Application

1. Start the server:

```bash
uvicorn main:app
```

2. Access the API documentation:

- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc


---

## ğŸš€ Deployment to Ubuntu Server

### **1ï¸âƒ£ Install Required Packages on the Server**
```sh
sudo apt update
sudo apt install python3-pip python3-venv nginx git -y
```

### **2ï¸âƒ£ Clone the Repository on the Server**
```sh
cd /var/www
sudo git clone https://github.com/your-dohoudaniel/fastapi-book-project.git
cd fastapi-book-project
```

### **3ï¸âƒ£ Set Up the Virtual Environment**
```sh
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### **4ï¸âƒ£ Start FastAPI with Gunicorn (Production Mode)**
```sh
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

---

## ğŸŒ Configure Nginx as a Reverse Proxy

### **1ï¸âƒ£ Install Nginx (If Not Installed)**
```sh
sudo apt install nginx -y
```

### **2ï¸âƒ£ Create an Nginx Configuration File**
```sh
sudo nano /etc/nginx/sites-available/fastapi
```

**Paste the following:**
```nginx
server {
    listen 80;
    server_name your_domain_or_ip;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### **3ï¸âƒ£ Enable the Configuration and Restart Nginx**
```sh
sudo ln -s /etc/nginx/sites-available/fastapi /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```


### **4ï¸âƒ£ Allow Firewall Rules**
```sh
sudo ufw allow 'Nginx Full'
sudo ufw reload
```


## API Endpoints

### Books

- `GET /api/v1/books/` - Get all books
- `GET /api/v1/books/{book_id}` - Get a specific book
- `POST /api/v1/books/` - Create a new book
- `PUT /api/v1/books/{book_id}` - Update a book
- `DELETE /api/v1/books/{book_id}` - Delete a book

### Health Check

- `GET /healthcheck` - Check API status

## Book Schema

```json
{
  "id": 1,
  "title": "Book Title",
  "author": "Author Name",
  "publication_year": 2024,
  "genre": "Fantasy"
}
```

Available genres:

- Science Fiction
- Fantasy
- Horror
- Mystery
- Romance
- Thriller

## Running Tests

```bash
pytest
```

## Error Handling

The API includes proper error handling for:

- Non-existent books
- Invalid book IDs
- Invalid genre types
- Malformed requests

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Support

For support, please open an issue in the GitHub repository.

<!--
# FastAPI Application with Nginx Reverse Proxy & CI/CD Deployment

## ğŸš€ Overview
This repository contains a FastAPI application that is deployed using **Nginx as a reverse proxy** and a **GitHub Actions CI/CD pipeline** for automated deployment.

## ğŸ“Œ Features
- RESTful API built with **FastAPI**
- **Nginx** as a reverse proxy
- **Uvicorn** for production
- **GitHub Actions** for CI/CD

---

## ğŸ“‚ Project Setup

### **1ï¸âƒ£ Clone the Repository**
```sh
git clone https://github.com/dohoudaniel/fastapi-book-project.git
cd fastapi-book-project
```

### **2ï¸âƒ£ Create and Activate a Virtual Environment**
```sh
python3 -m venv venv
source venv/bin/activate  # On macOS/Linux
venv\Scripts\activate    # On Windows
```

### **3ï¸âƒ£ Install Dependencies**
```sh
pip install -r requirements.txt
```

### **4ï¸âƒ£ Run the FastAPI Application Locally**
```sh
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```
Access the API at: [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)




---

## ğŸ”„ CI/CD Deployment with GitHub Actions

### **1ï¸âƒ£ Set Up SSH Keys for Deployment**
On your **local machine**, generate SSH keys:
```sh
ssh-keygen -t rsa -b 4096 -C "github-actions"
```
Copy the **public key (`id_rsa.pub`)** to the server:
```sh
echo "your-public-key-content" >> ~/.ssh/authorized_keys
```

### **2ï¸âƒ£ Add Secrets to GitHub**
Go to **GitHub Repository > Settings > Secrets and Variables > Actions** and add:
- `SSH_PRIVATE_KEY` â†’ Copy from `~/.ssh/id_rsa`
- `SERVER_IP` â†’ Your server's IP address
- `SERVER_USER` â†’ Your SSH username

### **3ï¸âƒ£ GitHub Actions Deployment Workflow**
Create `.github/workflows/deploy.yml` and add:
```yaml
name: Deploy FastAPI App

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up SSH
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts

      - name: Deploy FastAPI Application
        run: |
          ssh ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            cd /var/www/your-repo
            git pull origin main
            pip install -r requirements.txt
            sudo systemctl restart fastapi
            sudo systemctl restart nginx
          EOF
```

### **4ï¸âƒ£ Push to GitHub and Trigger Deployment**
```sh
git add .
git commit -m "Deploy FastAPI with Nginx"
git push origin main
```

GitHub Actions will automatically **deploy the latest changes** to your server.

---

## âœ… Testing Your Deployment
Check if Nginx and FastAPI are working:
```sh
curl -I http://your_domain_or_ip
```
Expected response:
```
HTTP/1.1 200 OK
```
If you set up SSL:
```sh
curl -I https://your_domain_or_ip
```

---

## ğŸ”¥ Troubleshooting
- Check if FastAPI is running:
  ```sh
  sudo systemctl status fastapi
  ```
- Check if Nginx is running:
  ```sh
  sudo systemctl status nginx
  ```
- View logs for errors:
  ```sh
  sudo journalctl -u nginx --no-pager | tail -n 20
  ```
  ```sh
  sudo journalctl -u fastapi --no-pager | tail -n 20
  ```

---

## ğŸ“œ License
This project is licensed under the **MIT License**.

---

## ğŸ‘¨â€ğŸ’» Author
Developed by **Daniel Dohou** - [GitHub Profile](https://github.com/your-username) ğŸš€

-->